<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gestión - Oficina de Abogado Dalcia Bello</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        
        .navbar-brand {
            font-weight: bold;
            color: var(--light-color) !important;
        }
        
        .sidebar {
            min-height: calc(100vh - 56px);
            background-color: var(--primary-color);
            color: white;
            padding-top: 20px;
        }
        
        .sidebar a {
            color: var(--light-color);
            padding: 10px 15px;
            display: block;
            text-decoration: none;
            transition: all 0.3s;
        }
        
        .sidebar a:hover, .sidebar a.active {
            background-color: var(--secondary-color);
            color: white;
        }
        
        .sidebar i {
            margin-right: 10px;
            width: 20px;
            text-align: center;
        }
        
        .content {
            padding: 20px;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: var(--primary-color);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: bold;
        }
        
        .btn-primary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        
        .btn-danger {
            background-color: var(--accent-color);
            border-color: var(--accent-color);
        }
        
        .badge-status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
        }
        
        .status-active {
            background-color: #d4edda;
            color: #155724;
        }
        
        .status-pending {
            background-color: #fff3cd;
            color: #856404;
        }
        
        .status-closed {
            background-color: #f8d7da;
            color: #721c24;
        }
        
        .calendar-container {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            background-color: white;
        }
        
        .logo-container {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .logo-container h3 {
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .file-list {
            max-height: 300px;
            overflow-y: auto;
        }
        
        .file-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .file-item:last-child {
            border-bottom: none;
        }
        
        .file-icon {
            color: var(--accent-color);
            font-size: 1.2rem;
            margin-right: 10px;
        }
        
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .dashboard-card {
            transition: transform 0.3s;
        }
        
        .dashboard-card:hover {
            transform: translateY(-5px);
        }
        
        .table th {
            background-color: var(--light-color);
            color: var(--dark-color);
        }
    </style>
</head>
<body>
    <!-- Login Screen (mostrado inicialmente) -->
    <div id="loginScreen" class="login-container">
        <div class="logo-container">
            <i class="fas fa-balance-scale fa-3x mb-3" style="color: var(--primary-color);"></i>
            <h3>Oficina de Abogado<br>Dalcia Bello</h3>
            <p class="text-muted">Sistema de gestión de expedientes</p>
        </div>
        
        <form id="loginForm">
            <div class="mb-3">
                <label for="username" class="form-label">Usuario</label>
                <input type="text" class="form-control" id="username" placeholder="Ingrese su usuario" required>
            </div>
            <div class="mb-3">
                <label for="password" class="form-label">Contraseña</label>
                <input type="password" class="form-control" id="password" placeholder="Ingrese su contraseña" required>
            </div>
            <div class="d-grid">
                <button type="submit" class="btn btn-primary">Iniciar Sesión</button>
            </div>
        </form>
        
        <div class="mt-3 text-center">
            <p class="text-muted">Demo: Usuario: admin / Contraseña: admin123</p>
        </div>
    </div>

    <!-- Main Application (oculto inicialmente) -->
    <div id="appContainer" style="display: none;">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: var(--primary-color);">
            <div class="container-fluid">
                <a class="navbar-brand" href="#">
                    <i class="fas fa-balance-scale me-2"></i>
                    Oficina Dalcia Bello
                </a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav ms-auto">
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                                <div class="d-flex align-items-center">
                                    <div class="user-avatar" id="userAvatar">DB</div>
                                    <div>
                                        <span id="currentUserName">Administrador</span>
                                        <small class="d-block" id="currentUserRole">Administrador</small>
                                    </div>
                                </div>
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#" onclick="showProfile()"><i class="fas fa-user me-2"></i> Mi perfil</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" onclick="logout()"><i class="fas fa-sign-out-alt me-2"></i> Cerrar sesión</a></li>
                            </ul>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="container-fluid">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-md-3 col-lg-2 sidebar d-md-block collapse" id="sidebar">
                    <div class="position-sticky">
                        <ul class="nav flex-column">
                            <li>
                                <a href="#" class="active" onclick="showDashboard()">
                                    <i class="fas fa-tachometer-alt"></i> Dashboard
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="showExpedientes()">
                                    <i class="fas fa-folder-open"></i> Expedientes
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="showCalendarView()">
                                    <i class="fas fa-calendar-alt"></i> Calendario de Audiencias
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="showUsers()" id="usersMenu" style="display: none;">
                                    <i class="fas fa-users"></i> Gestión de Usuarios
                                </a>
                            </li>
                            <li>
                                <a href="#" onclick="showProfile()">
                                    <i class="fas fa-user-cog"></i> Configuración
                                </a>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="col-md-9 col-lg-10 ms-sm-auto content" id="mainContent">
                    <!-- Dashboard -->
                    <div id="dashboardContent">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Dashboard</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <div class="btn-group me-2">
                                    <button type="button" class="btn btn-sm btn-outline-primary" onclick="showExpedientes()">
                                        <i class="fas fa-plus me-1"></i> Nuevo Expediente
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-3 mb-4">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Expedientes Activos</h5>
                                        <h2 class="display-4" id="activeCasesCount">12</h2>
                                        <p class="card-text">En proceso</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-4">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Audiencias Esta Semana</h5>
                                        <h2 class="display-4" id="weekHearingsCount">5</h2>
                                        <p class="card-text">Programadas</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-4">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Documentos Subidos</h5>
                                        <h2 class="display-4" id="documentsCount">47</h2>
                                        <p class="card-text">Archivos PDF</p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-3 mb-4">
                                <div class="card dashboard-card">
                                    <div class="card-body text-center">
                                        <h5 class="card-title">Usuarios Activos</h5>
                                        <h2 class="display-4" id="activeUsersCount">4</h2>
                                        <p class="card-text">En el sistema</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-8">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-calendar me-2"></i> Próximas Audiencias
                                    </div>
                                    <div class="card-body">
                                        <div id="upcomingHearings">
                                            <!-- Las próximas audiencias se cargarán aquí -->
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-chart-pie me-2"></i> Estado de Expedientes
                                    </div>
                                    <div class="card-body">
                                        <canvas id="casesChart" width="100%" height="200"></canvas>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Expedientes -->
                    <div id="expedientesContent" style="display: none;">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Gestión de Expedientes</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-primary" onclick="showNewExpedienteForm()">
                                    <i class="fas fa-plus me-1"></i> Nuevo Expediente
                                </button>
                            </div>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-12">
                                <div class="input-group">
                                    <input type="text" class="form-control" placeholder="Buscar expediente por número, cliente o descripción" id="searchExpediente">
                                    <button class="btn btn-outline-secondary" type="button" onclick="searchExpedientes()">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div id="expedientesList">
                            <!-- Lista de expedientes se cargará aquí -->
                        </div>
                        
                        <div id="expedienteDetail" style="display: none;">
                            <!-- Detalle del expediente se cargará aquí -->
                        </div>
                        
                        <div id="newExpedienteForm" style="display: none;">
                            <!-- Formulario para nuevo expediente se cargará aquí -->
                        </div>
                    </div>
                    
                    <!-- Calendario -->
                    <div id="calendarContent" style="display: none;">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Calendario de Audiencias</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-primary" onclick="showNewHearingForm()">
                                    <i class="fas fa-plus me-1"></i> Nueva Audiencia
                                </button>
                            </div>
                        </div>
                        
                        <div class="calendar-container">
                            <div id="calendar"></div>
                        </div>
                    </div>
                    
                    <!-- Gestión de Usuarios -->
                    <div id="usersContent" style="display: none;">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Gestión de Usuarios</h1>
                            <div class="btn-toolbar mb-2 mb-md-0">
                                <button type="button" class="btn btn-primary" onclick="showNewUserForm()">
                                    <i class="fas fa-user-plus me-1"></i> Nuevo Usuario
                                </button>
                            </div>
                        </div>
                        
                        <div id="usersList">
                            <!-- Lista de usuarios se cargará aquí -->
                        </div>
                        
                        <div id="newUserForm" style="display: none;">
                            <!-- Formulario para nuevo usuario se cargará aquí -->
                        </div>
                    </div>
                    
                    <!-- Perfil y Configuración -->
                    <div id="profileContent" style="display: none;">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                            <h1 class="h2">Mi Perfil</h1>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-user me-2"></i> Información Personal
                                    </div>
                                    <div class="card-body">
                                        <form id="profileForm">
                                            <div class="mb-3">
                                                <label for="profileName" class="form-label">Nombre Completo</label>
                                                <input type="text" class="form-control" id="profileName" value="Dalcia Bello">
                                            </div>
                                            <div class="mb-3">
                                                <label for="profileEmail" class="form-label">Correo Electrónico</label>
                                                <input type="email" class="form-control" id="profileEmail" value="dalcia.bello@abogados.com">
                                            </div>
                                            <div class="mb-3">
                                                <label for="profilePhone" class="form-label">Teléfono</label>
                                                <input type="text" class="form-control" id="profilePhone" value="+1 234 567 8900">
                                            </div>
                                            <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <i class="fas fa-lock me-2"></i> Cambiar Contraseña
                                    </div>
                                    <div class="card-body">
                                        <form id="passwordForm">
                                            <div class="mb-3">
                                                <label for="currentPassword" class="form-label">Contraseña Actual</label>
                                                <input type="password" class="form-control" id="currentPassword">
                                            </div>
                                            <div class="mb-3">
                                                <label for="newPassword" class="form-label">Nueva Contraseña</label>
                                                <input type="password" class="form-control" id="newPassword">
                                            </div>
                                            <div class="mb-3">
                                                <label for="confirmPassword" class="form-label">Confirmar Nueva Contraseña</label>
                                                <input type="password" class="form-control" id="confirmPassword">
                                            </div>
                                            <button type="submit" class="btn btn-primary">Cambiar Contraseña</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Nueva Audiencia -->
    <div class="modal fade" id="newHearingModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Nueva Audiencia</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="newHearingForm">
                        <div class="mb-3">
                            <label for="hearingTitle" class="form-label">Título</label>
                            <input type="text" class="form-control" id="hearingTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="hearingExpediente" class="form-label">Expediente Relacionado</label>
                            <select class="form-select" id="hearingExpediente" required>
                                <option value="">Seleccione un expediente</option>
                                <!-- Las opciones se cargarán dinámicamente -->
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="hearingDate" class="form-label">Fecha y Hora</label>
                            <input type="datetime-local" class="form-control" id="hearingDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="hearingLocation" class="form-label">Lugar/Tribunal</label>
                            <input type="text" class="form-control" id="hearingLocation" required>
                        </div>
                        <div class="mb-3">
                            <label for="hearingDescription" class="form-label">Descripción</label>
                            <textarea class="form-control" id="hearingDescription" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-primary" onclick="saveNewHearing()">Guardar Audiencia</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/locales/es.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script>
        // Variables globales
        let currentUser = null;
        let expedientes = [];
        let users = [];
        let hearings = [];
        let documents = [];
        
        // Datos de ejemplo
        const sampleData = {
            expedientes: [
                {
                    id: 1,
                    numero: "EXP-2023-001",
                    cliente: "Juan Pérez",
                    descripcion: "Caso de divorcio - Acuerdo de bienes",
                    estado: "activo",
                    fechaCreacion: "2023-05-15",
                    abogadoResponsable: "Dalcia Bello",
                    archivos: [
                        { nombre: "Demanda Inicial.pdf", fecha: "2023-05-16", tamano: "2.4 MB" },
                        { nombre: "Poder Notarial.pdf", fecha: "2023-05-20", tamano: "1.8 MB" }
                    ],
                    audiencias: [
                        { titulo: "Audiencia Inicial", fecha: "2023-06-10T09:00", lugar: "Juzgado Familiar N° 5" },
                        { titulo: "Mediación", fecha: "2023-07-15T10:30", lugar: "Centro de Mediación" }
                    ]
                },
                {
                    id: 2,
                    numero: "EXP-2023-002",
                    cliente: "Empresa XYZ S.A.",
                    descripcion: "Contrato de arrendamiento comercial - Incumplimiento",
                    estado: "activo",
                    fechaCreacion: "2023-06-10",
                    abogadoResponsable: "Carlos Rodríguez",
                    archivos: [
                        { nombre: "Contrato Original.pdf", fecha: "2023-06-12", tamano: "3.2 MB" },
                        { nombre: "Notificación de Incumplimiento.pdf", fecha: "2023-06-18", tamano: "1.5 MB" }
                    ],
                    audiencias: [
                        { titulo: "Conciliación", fecha: "2023-07-20T14:00", lugar: "Juzgado Civil N° 3" }
                    ]
                },
                {
                    id: 3,
                    numero: "EXP-2023-003",
                    cliente: "María González",
                    descripcion: "Caso de accidente de tránsito - Reclamo de daños",
                    estado: "pendiente",
                    fechaCreacion: "2023-07-05",
                    abogadoResponsable: "Dalcia Bello",
                    archivos: [
                        { nombre: "Informe Policial.pdf", fecha: "2023-07-06", tamano: "4.1 MB" },
                        { nombre: "Informe Médico.pdf", fecha: "2023-07-08", tamano: "2.7 MB" }
                    ],
                    audiencias: []
                },
                {
                    id: 4,
                    numero: "EXP-2022-015",
                    cliente: "Roberto Sánchez",
                    descripcion: "Testamento y sucesión",
                    estado: "cerrado",
                    fechaCreacion: "2022-11-20",
                    abogadoResponsable: "Ana Martínez",
                    archivos: [
                        { nombre: "Testamento.pdf", fecha: "2022-11-22", tamano: "1.9 MB" },
                        { nombre: "Acta de Defunción.pdf", fecha: "2022-11-25", tamano: "1.2 MB" },
                        { nombre: "Resolución Judicial.pdf", fecha: "2023-04-10", tamano: "2.3 MB" }
                    ],
                    audiencias: []
                }
            ],
            users: [
                { id: 1, nombre: "Dalcia Bello", email: "dalcia.bello@abogados.com", role: "admin", telefono: "+1 234 567 8900", activo: true },
                { id: 2, nombre: "Carlos Rodríguez", email: "carlos.rodriguez@abogados.com", role: "abogado", telefono: "+1 234 567 8901", activo: true },
                { id: 3, nombre: "Ana Martínez", email: "ana.martinez@abogados.com", role: "abogado", telefono: "+1 234 567 8902", activo: true },
                { id: 4, nombre: "Laura Fernández", email: "laura.fernandez@abogados.com", role: "asistente", telefono: "+1 234 567 8903", activo: true }
            ],
            hearings: [
                { id: 1, title: "Audiencia Inicial - EXP-2023-001", start: "2023-06-10T09:00:00", end: "2023-06-10T10:00:00", expedienteId: 1, lugar: "Juzgado Familiar N° 5", description: "Primera audiencia para presentación de demanda" },
                { id: 2, title: "Mediación - EXP-2023-001", start: "2023-07-15T10:30:00", end: "2023-07-15T12:00:00", expedienteId: 1, lugar: "Centro de Mediación", description: "Sesión de mediación para acuerdo de bienes" },
                { id: 3, title: "Conciliación - EXP-2023-002", start: "2023-07-20T14:00:00", end: "2023-07-20T15:30:00", expedienteId: 2, lugar: "Juzgado Civil N° 3", description: "Audiencia de conciliación por incumplimiento de contrato" },
                { id: 4, title: "Revisión de Documentos - EXP-2023-003", start: "2023-07-25T11:00:00", end: "2023-07-25T12:00:00", expedienteId: 3, lugar: "Oficina", description: "Revisión de informes médicos y policiales" }
            ]
        };
        
        // Inicializar la aplicación
        document.addEventListener('DOMContentLoaded', function() {
            // Cargar datos de ejemplo
            expedientes = sampleData.expedientes;
            users = sampleData.users;
            hearings = sampleData.hearings;
            
            // Configurar formulario de login
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
            
            // Inicializar con usuario admin por defecto para demo
            // En una aplicación real, esto no estaría aquí
            document.getElementById('username').value = 'admin';
            document.getElementById('password').value = 'admin123';
        });
        
        // Función de login
        function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            // Para demo, aceptamos cualquier usuario con contraseña no vacía
            // En una aplicación real, esto se validaría contra una base de datos
            if (username && password) {
                // Determinar el usuario basado en el nombre de usuario
                let user;
                if (username === 'admin') {
                    user = users[0]; // Dalcia Bello como admin
                } else if (username === 'carlos') {
                    user = users[1]; // Carlos Rodríguez
                } else if (username === 'ana') {
                    user = users[2]; // Ana Martínez
                } else if (username === 'laura') {
                    user = users[3]; // Laura Fernández
                } else {
                    // Usuario genérico
                    user = {
                        id: 5,
                        nombre: username.charAt(0).toUpperCase() + username.slice(1),
                        email: `${username}@abogados.com`,
                        role: 'abogado',
                        telefono: '+1 234 567 8900',
                        activo: true
                    };
                }
                
                currentUser = user;
                
                // Mostrar la aplicación y ocultar el login
                document.getElementById('loginScreen').style.display = 'none';
                document.getElementById('appContainer').style.display = 'block';
                
                // Actualizar la interfaz con la información del usuario
                document.getElementById('currentUserName').textContent = currentUser.nombre;
                document.getElementById('currentUserRole').textContent = currentUser.role === 'admin' ? 'Administrador' : 
                                                                         currentUser.role === 'abogado' ? 'Abogado' : 'Asistente';
                document.getElementById('userAvatar').textContent = currentUser.nombre.split(' ').map(n => n[0]).join('');
                
                // Mostrar/ocultar menú de gestión de usuarios solo para admin
                if (currentUser.role === 'admin') {
                    document.getElementById('usersMenu').style.display = 'block';
                }
                
                // Inicializar dashboard
                showDashboard();
                
                // Inicializar calendario
                initCalendar();
                
                // Inicializar gráfico
                initChart();
            } else {
                alert('Por favor ingrese usuario y contraseña');
            }
        }
        
        // Función de logout
        function logout() {
            currentUser = null;
            document.getElementById('appContainer').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            document.getElementById('loginForm').reset();
        }
        
        // Navegación entre secciones
        function showDashboard() {
            hideAllSections();
            document.getElementById('dashboardContent').style.display = 'block';
            updateDashboard();
            setActiveMenuItem('dashboard');
        }
        
        function showExpedientes() {
            hideAllSections();
            document.getElementById('expedientesContent').style.display = 'block';
            renderExpedientesList();
            setActiveMenuItem('expedientes');
        }
        
        function showCalendarView() {
            hideAllSections();
            document.getElementById('calendarContent').style.display = 'block';
            setActiveMenuItem('calendar');
        }
        
        function showUsers() {
            hideAllSections();
            document.getElementById('usersContent').style.display = 'block';
            renderUsersList();
            setActiveMenuItem('users');
        }
        
        function showProfile() {
            hideAllSections();
            document.getElementById('profileContent').style.display = 'block';
            setActiveMenuItem('profile');
            
            // Cargar datos del perfil
            document.getElementById('profileName').value = currentUser.nombre;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profilePhone').value = currentUser.telefono;
        }
        
        function hideAllSections() {
            document.getElementById('dashboardContent').style.display = 'none';
            document.getElementById('expedientesContent').style.display = 'none';
            document.getElementById('calendarContent').style.display = 'none';
            document.getElementById('usersContent').style.display = 'none';
            document.getElementById('profileContent').style.display = 'none';
            document.getElementById('expedienteDetail').style.display = 'none';
            document.getElementById('newExpedienteForm').style.display = 'none';
            document.getElementById('newUserForm').style.display = 'none';
        }
        
        function setActiveMenuItem(menuItem) {
            // Remover clase active de todos los items
            const menuItems = document.querySelectorAll('.sidebar a');
            menuItems.forEach(item => item.classList.remove('active'));
            
            // Agregar clase active al item seleccionado
            let targetItem;
            switch(menuItem) {
                case 'dashboard':
                    targetItem = menuItems[0];
                    break;
                case 'expedientes':
                    targetItem = menuItems[1];
                    break;
                case 'calendar':
                    targetItem = menuItems[2];
                    break;
                case 'users':
                    targetItem = menuItems[3];
                    break;
                case 'profile':
                    targetItem = menuItems[4];
                    break;
            }
            
            if (targetItem) {
                targetItem.classList.add('active');
            }
        }
        
        // Dashboard functions
        function updateDashboard() {
            // Actualizar contadores
            const activeCases = expedientes.filter(e => e.estado === 'activo').length;
            const pendingCases = expedientes.filter(e => e.estado === 'pendiente').length;
            const closedCases = expedientes.filter(e => e.estado === 'cerrado').length;
            
            document.getElementById('activeCasesCount').textContent = activeCases;
            
            // Contar audiencias de esta semana
            const today = new Date();
            const nextWeek = new Date(today.getTime() + 7 * 24 * 60 * 60 * 1000);
            const weekHearings = hearings.filter(h => {
                const hearingDate = new Date(h.start);
                return hearingDate >= today && hearingDate <= nextWeek;
            }).length;
            
            document.getElementById('weekHearingsCount').textContent = weekHearings;
            
            // Contar documentos
            let totalDocuments = 0;
            expedientes.forEach(e => {
                totalDocuments += e.archivos.length;
            });
            document.getElementById('documentsCount').textContent = totalDocuments;
            
            // Contar usuarios activos
            const activeUsers = users.filter(u => u.activo).length;
            document.getElementById('activeUsersCount').textContent = activeUsers;
            
            // Actualizar lista de próximas audiencias
            renderUpcomingHearings();
        }
        
        function renderUpcomingHearings() {
            const container = document.getElementById('upcomingHearings');
            const today = new Date();
            
            // Ordenar audiencias por fecha (más próximas primero)
            const sortedHearings = [...hearings].sort((a, b) => new Date(a.start) - new Date(b.start));
            
            // Filtrar solo audiencias futuras
            const upcoming = sortedHearings.filter(h => new Date(h.start) >= today).slice(0, 5);
            
            if (upcoming.length === 0) {
                container.innerHTML = '<p class="text-muted">No hay audiencias programadas para las próximas fechas.</p>';
                return;
            }
            
            let html = '<div class="list-group">';
            upcoming.forEach(hearing => {
                const hearingDate = new Date(hearing.start);
                const expediente = expedientes.find(e => e.id === hearing.expedienteId);
                
                html += `
                <div class="list-group-item list-group-item-action">
                    <div class="d-flex w-100 justify-content-between">
                        <h6 class="mb-1">${hearing.title}</h6>
                        <small>${formatDate(hearingDate)}</small>
                    </div>
                    <p class="mb-1">${expediente ? 'Expediente: ' + expediente.numero : ''}</p>
                    <small class="text-muted">${hearing.lugar}</small>
                </div>
                `;
            });
            html += '</div>';
            
            container.innerHTML = html;
        }
        
        function initChart() {
            const ctx = document.getElementById('casesChart').getContext('2d');
            
            // Contar casos por estado
            const activeCases = expedientes.filter(e => e.estado === 'activo').length;
            const pendingCases = expedientes.filter(e => e.estado === 'pendiente').length;
            const closedCases = expedientes.filter(e => e.estado === 'cerrado').length;
            
            const chart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Activos', 'Pendientes', 'Cerrados'],
                    datasets: [{
                        data: [activeCases, pendingCases, closedCases],
                        backgroundColor: [
                            '#28a745',
                            '#ffc107',
                            '#dc3545'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }
        
        // Expedientes functions
        function renderExpedientesList() {
            const container = document.getElementById('expedientesList');
            
            if (expedientes.length === 0) {
                container.innerHTML = '<div class="alert alert-info">No hay expedientes registrados.</div>';
                return;
            }
            
            let html = '<div class="table-responsive"><table class="table table-hover"><thead><tr><th>Número</th><th>Cliente</th><th>Descripción</th><th>Estado</th><th>Fecha Creación</th><th>Acciones</th></tr></thead><tbody>';
            
            expedientes.forEach(expediente => {
                let statusClass = '';
                let statusText = '';
                
                switch(expediente.estado) {
                    case 'activo':
                        statusClass = 'status-active';
                        statusText = 'Activo';
                        break;
                    case 'pendiente':
                        statusClass = 'status-pending';
                        statusText = 'Pendiente';
                        break;
                    case 'cerrado':
                        statusClass = 'status-closed';
                        statusText = 'Cerrado';
                        break;
                }
                
                html += `
                <tr>
                    <td>${expediente.numero}</td>
                    <td>${expediente.cliente}</td>
                    <td>${expediente.descripcion}</td>
                    <td><span class="badge-status ${statusClass}">${statusText}</span></td>
                    <td>${formatDate(new Date(expediente.fechaCreacion))}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewExpediente(${expediente.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-success" onclick="editExpediente(${expediente.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        ${currentUser.role === 'admin' ? `
                        <button class="btn btn-sm btn-outline-danger" onclick="deleteExpediente(${expediente.id})">
                            <i class="fas fa-trash"></i>
                        </button>` : ''}
                    </td>
                </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
        
        function viewExpediente(id) {
            const expediente = expedientes.find(e => e.id === id);
            if (!expediente) return;
            
            const container = document.getElementById('expedientesList');
            const detailContainer = document.getElementById('expedienteDetail');
            
            container.style.display = 'none';
            detailContainer.style.display = 'block';
            
            let statusClass = '';
            let statusText = '';
            
            switch(expediente.estado) {
                case 'activo':
                    statusClass = 'status-active';
                    statusText = 'Activo';
                    break;
                case 'pendiente':
                    statusClass = 'status-pending';
                    statusText = 'Pendiente';
                    break;
                case 'cerrado':
                    statusClass = 'status-closed';
                    statusText = 'Cerrado';
                    break;
            }
            
            let archivosHTML = '';
            if (expediente.archivos && expediente.archivos.length > 0) {
                archivosHTML = '<h5 class="mt-4">Documentos</h5><div class="file-list">';
                expediente.archivos.forEach(archivo => {
                    archivosHTML += `
                    <div class="file-item">
                        <div>
                            <i class="fas fa-file-pdf file-icon"></i>
                            ${archivo.nombre}
                        </div>
                        <div>
                            <span class="text-muted">${archivo.tamano}</span>
                            <button class="btn btn-sm btn-outline-primary ms-2">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                    `;
                });
                archivosHTML += '</div>';
            } else {
                archivosHTML = '<p class="text-muted">No hay documentos cargados.</p>';
            }
            
            let audienciasHTML = '';
            if (expediente.audiencias && expediente.audiencias.length > 0) {
                audienciasHTML = '<h5 class="mt-4">Audiencias Programadas</h5><div class="list-group">';
                expediente.audiencias.forEach(audiencia => {
                    audienciasHTML += `
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1">${audiencia.titulo}</h6>
                            <small>${formatDateTime(new Date(audiencia.fecha))}</small>
                        </div>
                        <p class="mb-1">${audiencia.lugar}</p>
                    </div>
                    `;
                });
                audienciasHTML += '</div>';
            } else {
                audienciasHTML = '<p class="text-muted">No hay audiencias programadas.</p>';
            }
            
            detailContainer.innerHTML = `
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3>Expediente: ${expediente.numero}</h3>
                <button class="btn btn-outline-secondary" onclick="backToExpedientesList()">
                    <i class="fas fa-arrow-left me-1"></i> Volver a la lista
                </button>
            </div>
            
            <div class="card">
                <div class="card-header">
                    Información del Expediente
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Cliente:</strong> ${expediente.cliente}</p>
                            <p><strong>Descripción:</strong> ${expediente.descripcion}</p>
                            <p><strong>Estado:</strong> <span class="badge-status ${statusClass}">${statusText}</span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Fecha de Creación:</strong> ${formatDate(new Date(expediente.fechaCreacion))}</p>
                            <p><strong>Abogado Responsable:</strong> ${expediente.abogadoResponsable}</p>
                            <p><strong>Número de Archivos:</strong> ${expediente.archivos.length}</p>
                        </div>
                    </div>
                    
                    ${archivosHTML}
                    
                    ${audienciasHTML}
                    
                    <div class="mt-4">
                        <button class="btn btn-primary" onclick="uploadFileToExpediente(${expediente.id})">
                            <i class="fas fa-upload me-1"></i> Subir Documento
                        </button>
                        <button class="btn btn-success ms-2" onclick="scheduleHearingForExpediente(${expediente.id})">
                            <i class="fas fa-calendar-plus me-1"></i> Agendar Audiencia
                        </button>
                    </div>
                </div>
            </div>
            `;
        }
        
        function backToExpedientesList() {
            document.getElementById('expedienteDetail').style.display = 'none';
            document.getElementById('expedientesList').style.display = 'block';
        }
        
        function showNewExpedienteForm() {
            const container = document.getElementById('expedientesList');
            const formContainer = document.getElementById('newExpedienteForm');
            
            container.style.display = 'none';
            formContainer.style.display = 'block';
            
            formContainer.innerHTML = `
            <div class="card">
                <div class="card-header">
                    Nuevo Expediente
                </div>
                <div class="card-body">
                    <form id="expedienteForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="expedienteNumero" class="form-label">Número de Expediente</label>
                                <input type="text" class="form-control" id="expedienteNumero" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="expedienteCliente" class="form-label">Cliente</label>
                                <input type="text" class="form-control" id="expedienteCliente" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="expedienteDescripcion" class="form-label">Descripción</label>
                            <textarea class="form-control" id="expedienteDescripcion" rows="3" required></textarea>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="expedienteEstado" class="form-label">Estado</label>
                                <select class="form-select" id="expedienteEstado" required>
                                    <option value="activo">Activo</option>
                                    <option value="pendiente">Pendiente</option>
                                    <option value="cerrado">Cerrado</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="expedienteAbogado" class="form-label">Abogado Responsable</label>
                                <select class="form-select" id="expedienteAbogado" required>
                                    <option value="Dalcia Bello">Dalcia Bello</option>
                                    <option value="Carlos Rodríguez">Carlos Rodríguez</option>
                                    <option value="Ana Martínez">Ana Martínez</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-secondary me-2" onclick="cancelNewExpediente()">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Guardar Expediente</button>
                        </div>
                    </form>
                </div>
            </div>
            `;
            
            document.getElementById('expedienteForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveNewExpediente();
            });
        }
        
        function cancelNewExpediente() {
            document.getElementById('newExpedienteForm').style.display = 'none';
            document.getElementById('expedientesList').style.display = 'block';
        }
        
        function saveNewExpediente() {
            const nuevoExpediente = {
                id: expedientes.length > 0 ? Math.max(...expedientes.map(e => e.id)) + 1 : 1,
                numero: document.getElementById('expedienteNumero').value,
                cliente: document.getElementById('expedienteCliente').value,
                descripcion: document.getElementById('expedienteDescripcion').value,
                estado: document.getElementById('expedienteEstado').value,
                fechaCreacion: new Date().toISOString().split('T')[0],
                abogadoResponsable: document.getElementById('expedienteAbogado').value,
                archivos: [],
                audiencias: []
            };
            
            expedientes.push(nuevoExpediente);
            alert('Expediente creado exitosamente');
            showExpedientes();
        }
        
        function editExpediente(id) {
            const expediente = expedientes.find(e => e.id === id);
            if (!expediente) return;
            
            alert(`Funcionalidad de edición para expediente ${expediente.numero} sería implementada aquí.`);
            // En una aplicación real, mostraría un formulario similar a showNewExpedienteForm pero con los datos precargados
        }
        
        function deleteExpediente(id) {
            if (confirm('¿Está seguro de eliminar este expediente?')) {
                expedientes = expedientes.filter(e => e.id !== id);
                renderExpedientesList();
                alert('Expediente eliminado');
            }
        }
        
        function uploadFileToExpediente(id) {
            alert(`Funcionalidad para subir archivos PDF al expediente ${id} sería implementada aquí.`);
            // En una aplicación real, permitiría seleccionar un archivo y subirlo al servidor
        }
        
        function scheduleHearingForExpediente(id) {
            const expediente = expedientes.find(e => e.id === id);
            if (!expediente) return;
            
            // Llenar el select de expedientes en el modal
            const select = document.getElementById('hearingExpediente');
            select.innerHTML = '<option value="">Seleccione un expediente</option>';
            expedientes.forEach(e => {
                select.innerHTML += `<option value="${e.id}" ${e.id === id ? 'selected' : ''}>${e.numero} - ${e.cliente}</option>`;
            });
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('newHearingModal'));
            modal.show();
        }
        
        function searchExpedientes() {
            const searchTerm = document.getElementById('searchExpediente').value.toLowerCase();
            if (!searchTerm) {
                renderExpedientesList();
                return;
            }
            
            const filtered = expedientes.filter(e => 
                e.numero.toLowerCase().includes(searchTerm) ||
                e.cliente.toLowerCase().includes(searchTerm) ||
                e.descripcion.toLowerCase().includes(searchTerm)
            );
            
            const container = document.getElementById('expedientesList');
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="alert alert-warning">No se encontraron expedientes que coincidan con la búsqueda.</div>';
                return;
            }
            
            let html = '<div class="table-responsive"><table class="table table-hover"><thead><tr><th>Número</th><th>Cliente</th><th>Descripción</th><th>Estado</th><th>Fecha Creación</th><th>Acciones</th></tr></thead><tbody>';
            
            filtered.forEach(expediente => {
                let statusClass = '';
                let statusText = '';
                
                switch(expediente.estado) {
                    case 'activo':
                        statusClass = 'status-active';
                        statusText = 'Activo';
                        break;
                    case 'pendiente':
                        statusClass = 'status-pending';
                        statusText = 'Pendiente';
                        break;
                    case 'cerrado':
                        statusClass = 'status-closed';
                        statusText = 'Cerrado';
                        break;
                }
                
                html += `
                <tr>
                    <td>${expediente.numero}</td>
                    <td>${expediente.cliente}</td>
                    <td>${expediente.descripcion}</td>
                    <td><span class="badge-status ${statusClass}">${statusText}</span></td>
                    <td>${formatDate(new Date(expediente.fechaCreacion))}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="viewExpediente(${expediente.id})">
                            <i class="fas fa-eye"></i>
                        </button>
                    </td>
                </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
        
        // Calendar functions
        function initCalendar() {
            const calendarEl = document.getElementById('calendar');
            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'es',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                events: hearings.map(h => ({
                    id: h.id,
                    title: h.title,
                    start: h.start,
                    end: h.end,
                    extendedProps: {
                        expedienteId: h.expedienteId,
                        lugar: h.lugar,
                        description: h.description
                    }
                })),
                eventClick: function(info) {
                    const hearing = hearings.find(h => h.id === parseInt(info.event.id));
                    if (hearing) {
                        alert(`Audiencia: ${info.event.title}\nLugar: ${hearing.lugar}\nDescripción: ${hearing.description || 'Sin descripción'}`);
                    }
                },
                dateClick: function(info) {
                    // Al hacer clic en una fecha, mostrar modal para agregar audiencia
                    document.getElementById('hearingDate').value = info.dateStr + 'T09:00';
                    const modal = new bootstrap.Modal(document.getElementById('newHearingModal'));
                    modal.show();
                }
            });
            
            calendar.render();
        }
        
        function showNewHearingForm() {
            // Llenar el select de expedientes en el modal
            const select = document.getElementById('hearingExpediente');
            select.innerHTML = '<option value="">Seleccione un expediente</option>';
            expedientes.forEach(e => {
                select.innerHTML += `<option value="${e.id}">${e.numero} - ${e.cliente}</option>`;
            });
            
            // Establecer fecha y hora por defecto (mañana a las 9 AM)
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(9, 0, 0, 0);
            
            const dateString = tomorrow.toISOString().slice(0, 16);
            document.getElementById('hearingDate').value = dateString;
            
            // Mostrar el modal
            const modal = new bootstrap.Modal(document.getElementById('newHearingModal'));
            modal.show();
        }
        
        function saveNewHearing() {
            const title = document.getElementById('hearingTitle').value;
            const expedienteId = parseInt(document.getElementById('hearingExpediente').value);
            const date = document.getElementById('hearingDate').value;
            const location = document.getElementById('hearingLocation').value;
            const description = document.getElementById('hearingDescription').value;
            
            if (!title || !expedienteId || !date || !location) {
                alert('Por favor complete todos los campos requeridos');
                return;
            }
            
            const expediente = expedientes.find(e => e.id === expedienteId);
            if (!expediente) {
                alert('Expediente no encontrado');
                return;
            }
            
            const newHearing = {
                id: hearings.length > 0 ? Math.max(...hearings.map(h => h.id)) + 1 : 1,
                title: `${title} - ${expediente.numero}`,
                start: date,
                end: new Date(new Date(date).getTime() + 60 * 60 * 1000).toISOString(), // 1 hora después
                expedienteId: expedienteId,
                lugar: location,
                description: description
            };
            
            hearings.push(newHearing);
            
            // Agregar la audiencia al expediente
            if (!expediente.audiencias) expediente.audiencias = [];
            expediente.audiencias.push({
                titulo: title,
                fecha: date,
                lugar: location
            });
            
            alert('Audiencia agendada exitosamente');
            
            // Cerrar modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('newHearingModal'));
            modal.hide();
            
            // Recargar calendario
            document.getElementById('calendar').innerHTML = '';
            initCalendar();
            
            // Actualizar dashboard si está visible
            if (document.getElementById('dashboardContent').style.display !== 'none') {
                updateDashboard();
            }
        }
        
        // Users functions
        function renderUsersList() {
            const container = document.getElementById('usersList');
            
            if (users.length === 0) {
                container.innerHTML = '<div class="alert alert-info">No hay usuarios registrados.</div>';
                return;
            }
            
            let html = '<div class="table-responsive"><table class="table table-hover"><thead><tr><th>Nombre</th><th>Email</th><th>Teléfono</th><th>Rol</th><th>Estado</th><th>Acciones</th></tr></thead><tbody>';
            
            users.forEach(user => {
                let roleText = '';
                switch(user.role) {
                    case 'admin':
                        roleText = 'Administrador';
                        break;
                    case 'abogado':
                        roleText = 'Abogado';
                        break;
                    case 'asistente':
                        roleText = 'Asistente';
                        break;
                }
                
                html += `
                <tr>
                    <td>
                        <div class="d-flex align-items-center">
                            <div class="user-avatar" style="width: 30px; height: 30px; font-size: 0.8rem;">
                                ${user.nombre.split(' ').map(n => n[0]).join('')}
                            </div>
                            ${user.nombre}
                        </div>
                    </td>
                    <td>${user.email}</td>
                    <td>${user.telefono}</td>
                    <td>${roleText}</td>
                    <td>${user.activo ? '<span class="badge bg-success">Activo</span>' : '<span class="badge bg-danger">Inactivo</span>'}</td>
                    <td>
                        <button class="btn btn-sm btn-outline-primary" onclick="editUser(${user.id})">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-outline-danger" onclick="toggleUserStatus(${user.id})" ${user.id === currentUser.id ? 'disabled' : ''}>
                            <i class="fas fa-user-slash"></i>
                        </button>
                    </td>
                </tr>
                `;
            });
            
            html += '</tbody></table></div>';
            container.innerHTML = html;
        }
        
        function showNewUserForm() {
            const container = document.getElementById('usersList');
            const formContainer = document.getElementById('newUserForm');
            
            container.style.display = 'none';
            formContainer.style.display = 'block';
            
            formContainer.innerHTML = `
            <div class="card">
                <div class="card-header">
                    Nuevo Usuario
                </div>
                <div class="card-body">
                    <form id="userForm">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userNombre" class="form-label">Nombre Completo</label>
                                <input type="text" class="form-control" id="userNombre" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userEmail" class="form-label">Correo Electrónico</label>
                                <input type="email" class="form-control" id="userEmail" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userTelefono" class="form-label">Teléfono</label>
                                <input type="text" class="form-control" id="userTelefono">
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userRol" class="form-label">Rol</label>
                                <select class="form-select" id="userRol" required>
                                    <option value="abogado">Abogado</option>
                                    <option value="asistente">Asistente</option>
                                    <option value="admin">Administrador</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="userPassword" class="form-label">Contraseña</label>
                                <input type="password" class="form-control" id="userPassword" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="userConfirmPassword" class="form-label">Confirmar Contraseña</label>
                                <input type="password" class="form-control" id="userConfirmPassword" required>
                            </div>
                        </div>
                        
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="userActivo" checked>
                            <label class="form-check-label" for="userActivo">
                                Usuario activo
                            </label>
                        </div>
                        
                        <div class="d-flex justify-content-end">
                            <button type="button" class="btn btn-secondary me-2" onclick="cancelNewUser()">Cancelar</button>
                            <button type="submit" class="btn btn-primary">Guardar Usuario</button>
                        </div>
                    </form>
                </div>
            </div>
            `;
            
            document.getElementById('userForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveNewUser();
            });
        }
        
        function cancelNewUser() {
            document.getElementById('newUserForm').style.display = 'none';
            document.getElementById('usersList').style.display = 'block';
        }
        
        function saveNewUser() {
            const password = document.getElementById('userPassword').value;
            const confirmPassword = document.getElementById('userConfirmPassword').value;
            
            if (password !== confirmPassword) {
                alert('Las contraseñas no coinciden');
                return;
            }
            
            const newUser = {
                id: users.length > 0 ? Math.max(...users.map(u => u.id)) + 1 : 1,
                nombre: document.getElementById('userNombre').value,
                email: document.getElementById('userEmail').value,
                telefono: document.getElementById('userTelefono').value,
                role: document.getElementById('userRol').value,
                activo: document.getElementById('userActivo').checked
            };
            
            users.push(newUser);
            alert('Usuario creado exitosamente');
            showUsers();
        }
        
        function editUser(id) {
            const user = users.find(u => u.id === id);
            if (!user) return;
            
            alert(`Funcionalidad de edición para usuario ${user.nombre} sería implementada aquí.`);
            // En una aplicación real, mostraría un formulario similar a showNewUserForm pero con los datos precargados
        }
        
        function toggleUserStatus(id) {
            const user = users.find(u => u.id === id);
            if (!user) return;
            
            if (confirm(`¿Está seguro de ${user.activo ? 'desactivar' : 'activar'} al usuario ${user.nombre}?`)) {
                user.activo = !user.activo;
                renderUsersList();
                alert(`Usuario ${user.activo ? 'activado' : 'desactivado'} exitosamente`);
            }
        }
        
        // Profile functions
        document.getElementById('profileForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            saveProfile();
        });
        
        document.getElementById('passwordForm')?.addEventListener('submit', function(e) {
            e.preventDefault();
            changePassword();
        });
        
        function saveProfile() {
            const name = document.getElementById('profileName').value;
            const email = document.getElementById('profileEmail').value;
            const phone = document.getElementById('profilePhone').value;
            
            // Actualizar datos del usuario actual
            currentUser.nombre = name;
            currentUser.email = email;
            currentUser.telefono = phone;
            
            // Actualizar en la lista de usuarios
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex] = {...currentUser};
            }
            
            // Actualizar en la interfaz
            document.getElementById('currentUserName').textContent = currentUser.nombre;
            document.getElementById('userAvatar').textContent = currentUser.nombre.split(' ').map(n => n[0]).join('');
            
            alert('Perfil actualizado exitosamente');
        }
        
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // En una aplicación real, se verificaría la contraseña actual contra la almacenada
            if (!currentPassword) {
                alert('Por favor ingrese su contraseña actual');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                alert('Las nuevas contraseñas no coinciden');
                return;
            }
            
            alert('Contraseña cambiada exitosamente (en una aplicación real, se guardaría en la base de datos)');
            
            // Limpiar formulario
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
        }
        
        // Utility functions
        function formatDate(date) {
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
        }
        
        function formatDateTime(date) {
            return date.toLocaleDateString('es-ES', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
    </script>
</body>
</html>